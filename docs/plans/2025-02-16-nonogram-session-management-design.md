# 数织游戏会话管理和点击记录功能设计

## 概述
为数织求解器添加游戏会话管理和点击记录功能，避免同一局游戏内重复弹出截图选择窗口和重复点击格子。

## 需求
1. **游戏会话识别**：页面加载后到清空按钮点击前为同一局游戏
2. **截图窗口控制**：同一局游戏内只弹出一次截图选择窗口
3. **点击记录**：记录已点击的格子，避免重复点击
4. **批量点击优化**：过滤已点击格子，点击后更新记录

## 设计方案

### 1. 数据结构

#### 游戏会话
```javascript
let gameSession = {
    id: null,              // 会话唯一ID（时间戳）
    hasConfigured: false   // 是否已配置过截图区域
};
```

#### 点击记录
```javascript
let clickedCells = new Set(); // 存储 "row,col" 格式的字符串
```

### 2. 功能流程

#### 会话初始化
- 页面加载时生成新会话ID
- 清空点击记录
- 重置配置状态

#### 求解流程
1. 检查是否首次求解
2. 如果是首次且需要网格配置，弹出截图窗口
3. 否则直接使用已有配置

#### 单个格子点击
1. 检查格子是否已点击
2. 未点击则执行点击并记录
3. 已点击则跳过

#### 批量点击流程
1. 收集所有待点击格子
2. 过滤掉已点击的格子
3. 执行批量点击
4. 将成功点击的格子标记为已点击
5. 显示实际点击数量（含跳过数量）

### 3. 实现要点

#### 会话ID生成
使用时间戳确保唯一性：
```javascript
gameSession.id = Date.now().toString();
```

#### 格子坐标格式
使用 "row,col" 字符串格式，例如：
```javascript
clickedCells.add("2,3"); // 第3行第4列
```

#### 状态信息优化
- 显示实际点击数量
- 提示跳过的已点击格子数量
- 保持原有成功/失败状态反馈

### 4. 修改点

#### 新增函数
- `initGameSession()`: 初始化游戏会话
- `isCellClicked(row, col)`: 检查格子是否已点击
- `markCellClicked(row, col)`: 标记格子为已点击

#### 修改函数
- `solve()`: 添加会话检查逻辑
- `clearConstraints()`: 重置会话和记录
- `handleCellClick()`: 添加点击检查和记录
- `batchTapAllFilled()`: 添加过滤和记录逻辑
- `batchTapAllEmpty()`: 添加过滤和记录逻辑

### 5. 用户交互

#### 视觉反馈
- 已点击格子保持原样（无额外标记）
- 状态栏显示点击统计信息
- 截图窗口按会话控制显示

#### 异常处理
- 会话数据损坏时自动重置
- 点击记录异常不影响正常游戏流程

## 预期效果
1. 同一局游戏内截图窗口只弹出一次
2. 不会重复点击任何格子
3. 批量点击效率提升
4. 用户体验更流畅